# @category: types
# @subcategory: functions
# @priority: medium
# @description: Test power and exponentiation with integer and fractional exponents and various base values

start simulation FunctionsPower

  grid.size = 10 m
  grid.low.x = 0 m
  grid.low.y = 0 m
  grid.high.x = 100 m
  grid.high.y = 100 m  # 10x10 grid
  grid.patch = "Default"

  steps.low = 0 count
  steps.high = 1 count

end simulation

start patch Default

  # Test power with integer exponent
  base2.init = 2 m
  power2to3.init = base2 ^ 3
  assert.power2to3.init = power2to3 == 8 m

  base3.init = 3 m
  power3to2.init = base3 ^ 2
  assert.power3to2.init = power3to2 == 9 m

  # Test power with exponent 0 (should always be 1)
  base5.init = 5 m
  power5to0.init = base5 ^ 0
  assert.power5to0.init = power5to0 == 1 m

  # Test power with exponent 1 (should equal base)
  power5to1.init = base5 ^ 1
  assert.power5to1.init = power5to1 == 5 m

  # Test power with larger exponent
  base10.init = 10 m
  power10to4.init = base10 ^ 4
  assert.power10to4.init = power10to4 == 10000 m

  # Test square root (exponent 0.5)
  base4.init = 4 m
  sqrt4.init = base4 ^ 0.5
  assert.sqrt4.init = sqrt4 == 2 m

  base9.init = 9 m
  sqrt9.init = base9 ^ 0.5
  assert.sqrt9.init = sqrt9 == 3 m

  # Test fractional exponent (cube root = 1/3)
  base8.init = 8 m
  cubeRoot8.init = base8 ^ 0.333333
  # 8^(1/3) â‰ˆ 2, test with tolerance
  assert.cubeRoot8.init = cubeRoot8 > 1.99 m
  assert.cubeRoot8b.init = cubeRoot8 < 2.01 m

  # Test with base 1 (should always be 1)
  base1.init = 1 m
  power1to5.init = base1 ^ 5
  assert.power1to5.init = power1to5 == 1 m

  # NOTE: Negative exponents (e.g., ^ -1, ^ -2) are not currently supported by the parser
  # These tests have been removed until the parser is updated to handle negative exponents

  # Test power preserves base units
  distance.init = 3 m
  distanceSquared.init = distance ^ 2
  assert.distanceSquared.init = distanceSquared == 9 m

end patch

start unit m
  alias meter
  alias meters
end unit

start unit count
end unit

start unit degrees
end unit
