# @category: types
# @subcategory: scalars
# @priority: medium
# @description: Test order of operations with scalar arithmetic

start simulation ScalarsArithmeticPrecedence

  grid.size = 1 km
  grid.low.x = 0 m
  grid.low.y = 0 m
  grid.high.x = 1 km
  grid.high.y = 1 km  # 1x1 grid
  grid.patch = "Default"

  steps.low = 0 count
  steps.high = 1 count

end simulation

start patch Default

  # Test precedence: multiplication before addition (with dimensionless)
  # 2 m + 3 count * 4 m = 2 m + 12 m = 14 m
  value1.init = 2 m
  value2.init = 3 count
  value3.init = 4 m
  result1.init = value1 + value2 * value3
  assert.multiplicationFirst.init = result1 == 14 m

  # Test with parentheses: addition before multiplication
  # (2 count + 3 count) * 4 m = 5 count * 4 m = 20 m
  dimValue1.init = 2 count
  dimValue2.init = 3 count
  sum.init = dimValue1 + dimValue2
  result2.init = sum * value3
  assert.parenthesesForce.init = result2 == 20 m

  # Test division before subtraction
  # 20 m - 10 m / 2 count = 20 m - 5 m = 15 m
  base.init = 20 m
  divisor1.init = 10 m
  divisor2.init = 2 count
  result3.init = base - divisor1 / divisor2
  assert.divisionFirst.init = result3 == 15 m

  # Test with parentheses: subtraction before division
  # (20 m - 10 m) / 2 count = 10 m / 2 count = 5 m
  diff.init = base - divisor1
  result4.init = diff / divisor2
  assert.parenthesesSubtract.init = result4 == 5 m

  # Test multiplication creating compound units
  # 2 m * 3 m = 6 m * m (compound units)
  length.init = 2 m
  width.init = 3 m
  area.init = length * width
  expectedArea.init = 6 m * 1 m
  assert.compoundUnits.init = area == expectedArea

  # Test division simplifying compound units
  # (2 m * 3 m) / 2 m = 6 m*m / 2 m = 3 m
  simplifiedWidth.init = area / length
  assert.simplification.init = simplifiedWidth == 3 m

  # Test precedence with compound units
  # 2 m * 3 m + 4 m * 5 m = 6 m*m + 20 m*m = 26 m*m
  area1.init = 2 m * 3 m
  area2.init = 4 m * 5 m
  totalArea.init = area1 + area2
  expectedTotalArea.init = 26 m * 1 m
  assert.compoundAddition.init = totalArea == expectedTotalArea

end patch

start unit m
  alias meter
  alias meters
end unit

start unit km
  alias kilometer
  alias kilometers
end unit

start unit count
end unit

start unit degrees
end unit
