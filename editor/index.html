<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Josh Web Editor</title>
    <link href="/third_party/tabby-ui.min.css" rel="stylesheet" type="text/css" />
    <link href="/style/style.css?v=EPOCH" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <header>
      <div class="beta-warning">
        This tool is under development and currently in beta testing. We would love to hear from
        you! Let us know your feedback at <a href="mailto:hello@joshsim.org">hello@joshsim.org</a>
        and we are here to help if you run into any issues.
      </div>
      <h1>Josh Simulation Editor</h1>
      This web-based editor allows for rapid prototyping Josh agent-based simulations from your browser. These scripts are only saved within your browser and are not sent to external servers unless requested. Try out small scripts in your browser. Then, run on cloud or CLI when ready to execute larger simulations.
      <div class="file-buttons buttons-panel" id="file-buttons">
        <a href="#" id="new-file-button" class="secondary">New File</a>
        <a href="#" id="load-file-button" class="secondary">Load File</a>
        <a href="#" download="simulation.josh" id="save-file-button" class="secondary">Save File</a>

        <dialog id="load-file-dialog">
          <h2>Open File</h2>
          <p>Note that this will override code currently entered into the application.</p>
          <div><label for="upload-file">File (.josh recommended):</label></div>
          <div><input type="file" class="upload-file" id="upload-file" name="upload-file" /></div>
          <div class="dialog-buttons bold-buttons">
            <a href="#" class="load-button primary">Open</a>
            <a href="#" class="cancel-button destructive">Cancel</a>
          </div>
        </dialog>
      </div>
    </header>

    <section id="loading">
      <img src="/style/90-ring.svg" alt="Loading indicator" /> Loading please wait...
    </section>

    <div id="main-holder">
      <main id="main">
        <section id="editor">
          <h2>Simulation</h2>
          <div id="code-editor-pane">
            <div id="code-editor">
              <div id="code-editor-inner" class="inner"></div>
              <div class="error-display"></div>
            </div>
            <div id="code-buttons-panel" class="buttons-panel">
              <div id="available-panel">
                <a class="primary" id="open-run-dialog-button" href="#run">Run</a>
                <a class="secondary" id="open-data-dialog-button" href="#data">Data Files</a>
              </div>
              <dialog id="run-local-dialog">
                <h2>Run</h2>
                <p>This will run your simulation in your browser using your computer.</p>
                <div class="form-group">
                  <div><label for="simulation-name">Simulation:</label></div>
                  <div class="sel long">
                    <select class="simulation-select"></select>
                  </div>
                </div>
                <div class="form-group">
                  <div><label for="simulation-name">Replicates:</label></div>
                  <div class="sel long">
                    <input class="replicates-input" type="number" value="1">
                  </div>
                </div>
                <div class="dialog-buttons bold-buttons">
                  <a href="#" class="run-button primary">Open</a>
                  <a href="#" class="cancel-button destructive">Cancel</a>
                </div>
              </dialog>
            </div>
          </div>
        </section>
        <section id="results">
          <h2>Run</h2>

          <div id="results-area">
            <div id="status-panel" class="results-panel">
              <h3>Execution status</h3>
              <div>
                <div class="running-indicator status-display">
                  <span class="running-icon">‚åõ</span>
                  <span class="complete-icon">‚úÖ</span>
                  <span class="status-text">Please wait...</span>
                </div>
                <div class="error-display status-display">
                  ‚ö†Ô∏è Encountered error: <span class="error-message"></span>.
                </div>
                <div class="timing-indicator finish-display status-display">
                  ‚è∞ Ran in <span class="completed-minutes"></span> minutes and <span class="completed-seconds"></span> seconds.
                </div>
                <div class="dataset-indicator finish-display status-display">
                  üíæ Collected <span class="completed-records"></span> records.
                </div>
                <div class="dataset-indicator finish-display status-display">
                  üöÄ Need to go faster? Run on <a href="#" class="cta-cloud">cloud</a> or <a href="#" class="cta-cli">CLI</a>.
                </div>
              </div>
            </div>
            
            <div id="viz-panel" class="results-panel">
              <div id="no-data-message">
                <h3>Results</h3>
                
                No data were reported for this simulation. To add data to an export, consider adding code like this:
  
                <pre>
start patch Default

  # ...

  export.averageAge.step = mean(ForeverTree.age)
  export.averageHeight.step = mean(ForeverTree.height)

  # ...

end patch
                </pre>

              Then, specify that the results should be written to this editor's visualizations:

                <pre>
start simulation Simulation

  # ...

  exportFiles.patch = "memory://editor/patches"

  # ...

end simulation
                </pre>
              </div>
              <div id="data-display">
                
                <div class="header-button-grid">
                  <h3>Results</h3>
                
                  <div id="download-buttons" class="buttons-panel">
                    <div class="button-holder">
                      <a class="primary" id="download-patches-button" href="#download-patches">Download Patch Exports</a>
                    </div>
                    <div class="button-holder">
                      <a class="secondary" id="download-simulation-button" href="#download-simulation">Simulation</a>
                    </div>
                    <div class="button-holder">
                      <a class="secondary" id="download-entity-button" href="#download-entities">Entities</a>
                    </div>
                  </div>
                </div>
                
                <div id="data-selector">
                  Showing
                  <span class="sel">
                    <select class="metric-select data-select-option">
                      <option value="mean" selected>mean</option>
                      <option value="median">median</option>
                      <option value="min">min</option>
                      <option value="max">max</option>
                      <option value="std">std dev</option>
                      <option value="probability">probability</option>
                    </select>
                  </span>
                  <span class="probability-controls">
                    that
                  </span>
                  <span class="regular-metric-controls">
                    of
                  </span>
                  <span class="sel long">
                    <select class="variable-select data-select-option"></select>
                  </span>
                  <span class="probability-controls">
                    <span class="sel">
                      <select class="probability-range-target data-select-option">
                        <option value="exceeds" selected>exceeds</option>
                        <option value="falls below">falls below</option>
                        <option value="is between">is between</option>
                      </select>
                    </span>
                    <span class="target-a">
                      <input type="number" class="target-a-input data-select-option">
                    </span>
                    <span class="target-b">
                      to
                      <input type="number" class="target-b-input data-select-option">
                    </span>
                  </span>
                  .
                </div>

                <div class="viz-holder" id="scrub-viz-holder">
                  <svg id="scrub-viz"></svg>
                </div>

                <div class="viz-holder" id="grid-viz-holder">
                  <div id="grid-viz-info"></div>
                  <svg id="grid-viz"></svg>
                </div>
                
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script type="text/javascript" src="/third_party/ace.min.js"></script>
    <script type="text/javascript" src="/third_party/d3.min.js"></script>
    <script type="text/javascript" src="/third_party/ext-language_tools.js"></script>
    <script type="text/javascript" src="/third_party/ext-options.js"></script>
    <script type="text/javascript" src="/third_party/ext-prompt.js"></script>
    <script type="text/javascript" src="/third_party/ext-searchbox.js"></script>
    <script type="text/javascript" src="/third_party/math.min.js"></script>
    <script type="text/javascript" src="/third_party/tabby.min.js"></script>

    <script type="importmap">
      {
        "imports": {
          "editor": "/js/editor.js?v=EPOCH",
          "file": "/js/file.js?v=EPOCH",
          "main": "/js/main.js?v=EPOCH",
          "model": "/js/model.js?v=EPOCH",
          "results": "/js/results.js?v=EPOCH",
          "run": "/js/run.js?v=EPOCH",
          "summarize": "/js/summarize.js?v=EPOCH",
          "viz": "/js/viz.js?v=EPOCH",
          "wasm": "/js/wasm.js?v=EPOCH"
        }
      }
    </script>

    <!-- Resources for WASM runtime. -->
    <script type="text/javascript" charset="utf-8" src="/war/wasm-gc/JoshSim.wasm-runtime.js"></script>

    <script type="module">
      import {main} from "main";

      /**
       * Load the WASM resource.
       */
      async function scaffold() {
        main();
      }

      setTimeout(scaffold, 500);
    </script>
  </body>
</html>