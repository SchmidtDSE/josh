start simulation TestLineage
  grid.size = 1000 m
  grid.low = 0 degrees latitude, 0 degrees longitude
  grid.high = 1 degrees latitude, 1 degrees longitude
  grid.patch = "TestPatch"

  steps.low = 0 count
  steps.high = 5 count

  exportFiles.patch = "file:///tmp/test_parent_lineage_patches.csv"
end simulation

start patch TestPatch
  # Create grandparent tree
  Tree.init = create 1 count of GrandparentTree

  # Simple export to verify patch executes
  export.testValue.step = 1 count
end patch

start organism GrandparentTree
  generation.init = 1 count
  age.init = 0 years
  age.step = prior.age + 1 years

  # Create child at age 2
  Child.step:if(current.age == 2 years) = create 1 count of ParentSeed
end organism

start organism ParentSeed
  generation.init = 2 count
  age.init = 0 years
  age.step = prior.age + 1 years

  # Create grandchild at age 1
  Grandchild.step:if(current.age == 1 years) = create 1 count of GrandchildSeedling
end organism

start organism GrandchildSeedling
  generation.init = 3 count

  # Access multi-level lineage - basic parent access works
  parentGen.init = parent.generation

  # Note: parent.parent.generation demonstrates multi-level lineage capability
  # but would fail if parent.parent is a Patch (which has no parent)
  # In this test, parent is ParentSeed, parent.parent is GrandparentTree,
  # and parent.parent.parent would be the Patch
end organism

start unit year
  alias years
end unit
